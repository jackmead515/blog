(this["webpackJsonpsat-tester"]=this["webpackJsonpsat-tester"]||[]).push([[0],{17:function(t,e,n){t.exports=n(24)},23:function(t,e,n){},24:function(t,e,n){"use strict";n.r(e);var a=n(0),i=n.n(a),s=n(14),r=n.n(s),o=n(12),h=n.n(o),l=n(15),c=n(3),u=n(5),d=n(7),v=n(6),m=n(1),g=n(8),y=n(4),f=n(10);var p={subtract:function(t,e){return[t[0]-e[0],t[1]-e[1]]},normal:function(t){return[-t[1],t[0]]},normalize:function(t){var e=Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2));return[t[0]/e,t[1]/e]},dot:function(t,e){return t[0]*e[0]+t[1]*e[1]}};function w(t,e,n){n.x<0&&(n.vx=.5*-n.vx,n.x=0),n.y<0&&(n.vy=.5*-n.vy,n.y=0),n.x+n.width>t&&(n.vx=.5*-n.vx,n.x=t-n.width),n.y+n.height>e&&(n.vy=.5*-n.vy,n.y=e-n.height)}function b(t){return[t.x+t.width/2,t.y+t.height/2]}function k(t,e){for(var n=p.dot(t,e[0]),a=n,i=n,s=0;s<e.length;s++){var r=e[s];(n=p.dot(t,r))<a?a=n:n>i&&(i=n)}return[a,i]}function _(t){var e=[];return e.push([t.x,t.y]),e.push([t.x,t.y+t.height]),e.push([t.x+t.width,t.y+t.height]),e.push([t.x+t.width,t.y]),e}function x(t){for(var e=[],n=0;n<t.length;n++){var a=t[n],i=t[n+1===t.length?0:n+1];e.push(p.subtract(a,i))}return e}function E(t,e){for(var n=1/0,a=[0,0],i=_(t),s=_(e),r=x(i),o=x(s),h=0;h<r.length;h++){var l=r[h],c=p.normalize(p.normal(l)),u=k(c,i),d=k(c,s),v=Math.max(0,Math.min(u[1],d[1])-Math.max(u[0],d[0]));if(0===v)return null;v<n&&(n=v,a=c)}for(var m=0;m<o.length;m++){var g=o[m],y=p.normalize(p.normal(g)),f=k(y,i),w=k(y,s),E=Math.max(0,Math.min(f[1],w[1])-Math.max(f[0],w[0]));if(0===E)return null;E<n&&(n=E,a=y)}var C=[a[0]*n,a[1]*n],j=p.subtract(b(t),b(e));return p.dot(a,j)<0?[-C[0],-C[1]]:C}function C(t,e,n){var a=e.x-t.x,i=e.y-t.y,s=Math.sqrt(a*a+i*i),r=a/s,o=i/s,h=-o,l=r,c=t.vx*h+t.vy*l,u=e.vx*h+e.vy*l,d=t.vx*r+t.vy*o,v=e.vx*r+e.vy*o,m=(d*(t.mass-e.mass)+2*e.mass*v)/(t.mass+e.mass),g=(v*(e.mass-t.mass)+2*t.mass*d)/(t.mass+e.mass);t.vx=(h*c+r*m)*n,t.vy=(l*c+o*m)*n,e.vx=(h*u+r*g)*n,e.vy=(l*u+o*g)*n}function j(t,e,n){var a=0,i=0,s=t.x-e.x,r=t.y-e.y,o=s*s+r*r,h=Math.sqrt(o);if(o>5){var l=n*(t.mass*e.mass/o);a+=l*s/h,i+=l*r/h}t.vx-=a,t.vy-=i}var M=function(){function t(e,n,a,i){Object(c.a)(this,t),this.rects=[],this.world_width=e,this.world_height=n,this.gravity_constant=a,this.damping=i,this.gravity_enabled=!0,this.collision_enabled=!0,this.elastic_enabled=!0,this.sun={id:0,collision:!1,width:0,height:0,x:e/2,y:n/2,vx:0,vy:0,ax:0,ay:0,mass:50}}return Object(u.a)(t,[{key:"reset",value:function(){this.rects=[]}},{key:"generate",value:function(t){for(var e=0;e<t;e++){var n=Math.random()*this.world_width,a=Math.random()*this.world_height,i=Math.random(),s=Math.random();Math.random()>.5&&(i=-i),Math.random()>.5&&(s=-s),this.rects.push({id:e,collision:!1,width:5,height:5,x:n,y:a,vx:i,vy:s,mass:25,ax:0,ay:0})}}},{key:"get_rects",value:function(){return this.rects}},{key:"set_damping",value:function(t){this.damping=t}},{key:"set_gravity_enabled",value:function(t){this.gravity_enabled=t}},{key:"set_collision_enabled",value:function(t){this.collision_enabled=t}},{key:"set_elastic_enabled",value:function(t){this.elastic_enabled=t}},{key:"set_gravity_constant",value:function(t){this.gravity_constant=t}},{key:"set_sun_mass",value:function(t){this.sun.mass=t}},{key:"tick",value:function(t){for(var e=0;e<this.rects.length;e++){var n=this.rects[e];n.x+=n.vx,n.y+=n.vy,this.gravity_enabled&&j(n,this.sun,this.gravity_constant);for(var a=0;a<this.rects.length;a++){var i=this.rects[a];if(i.id!==n.id&&(this.gravity_enabled&&j(n,i,this.gravity_constant),this.collision_enabled)){var s=E(n,i);null!==s&&(n.x+=s[0],n.y+=s[1],i.x-=s[0],i.y-=s[1],this.elastic_enabled&&C(n,i,this.damping))}}w(this.world_width,this.world_height,n),t[e]=n}}}],[{key:"new",value:function(e,n,a,i){return new t(e,n,a,i)}}]),t}(),S=null;function N(){for(var t="#",e=0;e<6;e++)t+="0123456789ABCDEF"[Math.floor(16*Math.random())];return t}var A={},O={},D=function(t){function e(t){var n;return Object(c.a)(this,e),(n=Object(d.a)(this,Object(v.a)(e).call(this,t))).state={rects:[],controls:!0,elastic:!0,collision:!0,gravity:!0,wasm:!1,amount:20,sunMass:0,gravityConstant:5e-4,damping:1,fps:0,d3:!0},n.animation=null,n.world_width=null,n.world_height=null,n.sun=null,n.stop=n.stop.bind(Object(m.a)(n)),n.start=n.start.bind(Object(m.a)(n)),n.restart=n.restart.bind(Object(m.a)(n)),n.center=n.center.bind(Object(m.a)(n)),n.engine=null,n.tj={},n}return Object(g.a)(e,t),Object(u.a)(e,[{key:"componentDidMount",value:function(){this.loadWasm(),this.dragGraph()}},{key:"componentWillUnmount",value:function(){this.stop()}},{key:"dragGraph",value:function(){var t=document.getElementById("graph");t&&function(t){var e=[0,0,0,0];function n(n){(n=n||window.event).preventDefault(),2===n.which&&(e[0]=e[2]-n.clientX,e[1]=e[3]-n.clientY,e[2]=n.clientX,e[3]=n.clientY,t.style.top=t.offsetTop-e[1]+"px",t.style.left=t.offsetLeft-e[0]+"px")}function a(){document.onmouseup=null,document.onmousemove=null}t.onmousedown=function(t){(t=t||window.event).preventDefault(),2===t.which&&(e[2]=t.clientX,e[3]=t.clientY,document.onmouseup=a,document.onmousemove=n)}}(t)}},{key:"loadWasm",value:function(){var t=Object(l.a)(h.a.mark((function t(){var e,a;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.e(3).then(n.bind(null,28));case 2:e=t.sent,a=e.Engine,S=a,this.createEngine();case 6:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"restart",value:function(){this.stop(),this.d3Rects={},this.tjRects={},this.tj={};var t=document.getElementById("graph");if(t){var e=!0,n=!1,a=void 0;try{for(var i,s=t.children[Symbol.iterator]();!(e=(i=s.next()).done);e=!0){var r=i.value,o=r.tagName.toLowerCase();"svg"!==o&&"canvas"!==o||r.parentElement.removeChild(r)}}catch(h){n=!0,a=h}finally{try{e||null==s.return||s.return()}finally{if(n)throw a}}}this.createEngine()}},{key:"start",value:function(){null===this.animation&&(this.state.d3?this.d3Loop():this.tjLoop())}},{key:"stop",value:function(){null!==this.animation&&(window.cancelAnimationFrame(this.animation),this.animation=null)}},{key:"center",value:function(){var t=document.getElementById("graph");t&&(t.style.top="calc(-1500px + 50vh)",t.style.left="calc(-1500px + 100vh)")}},{key:"createEngine",value:function(){if(!this.state.d3)return this.createTJEngine();this.createD3Engine()}},{key:"createD3Engine",value:function(){var t=f.a("#graph").node().getBoundingClientRect();this.world_width=t.width,this.world_height=t.height;var e=f.a("#graph").append("svg").attr("id","svg").attr("width",this.world_width).attr("height",this.world_height);this.sun=e.append("circle").attr("fill","#ffee02").attr("r",30).attr("cx",this.world_width/2).attr("cy",this.world_height/2);var n=this.state.wasm?S:M;this.engine=n.new(this.world_width,this.world_height,this.state.gravityConstant,this.state.damping),this.engine.generate(this.state.amount);var a=this.engine.get_rects(),i=!0,s=!1,r=void 0;try{for(var o,h=a[Symbol.iterator]();!(i=(o=h.next()).done);i=!0){var l=o.value;A[l.id]=e.append("rect").attr("fill","".concat(N())).attr("width",l.width).attr("height",l.height).attr("x",l.x).attr("y",l.y)}}catch(c){s=!0,r=c}finally{try{i||null==h.return||h.return()}finally{if(s)throw r}}}},{key:"createTJEngine",value:function(){var t=document.getElementById("graph"),e=t.getBoundingClientRect();this.world_width=e.width,this.world_height=e.height,this.tj.camera=new y.d(75,this.world_width/this.world_height,.01,10),this.tj.camera.position.z=1,this.tj.scene=new y.e,this.tj.renderer=new y.f({antialias:!0}),this.tj.renderer.setSize(this.world_width,this.world_height),t.appendChild(this.tj.renderer.domElement);var n=this.state.wasm?S:M;this.engine=n.new(this.world_width,this.world_height,this.state.gravityConstant,this.state.damping),this.engine.generate(this.state.amount);var a=this.engine.get_rects(),i=!0,s=!1,r=void 0;try{for(var o,h=a[Symbol.iterator]();!(i=(o=h.next()).done);i=!0){var l=o.value,c=new y.a(.2,.2,.2),u=new y.c({color:65280}),d=new y.b(c,u);O[l.id]=d,this.tj.scene.add(d);break}}catch(v){s=!0,r=v}finally{try{i||null==h.return||h.return()}finally{if(s)throw r}}}},{key:"onChangeAmount",value:function(t){var e=t.target.value;e=e>0?e:0,this.setState({amount:e})}},{key:"onChangeSunMass",value:function(t){var e=t.target.value;e=e>=0?e:0,this.setState({sunMass:e}),this.engine&&this.engine.set_sun_mass(e)}},{key:"onChangeGravityConstant",value:function(t){var e=t.target.value;e=e>=0?e:0,this.setState({gravityConstant:e}),this.engine&&this.engine.set_gravity_constant(e)}},{key:"onChangeDamping",value:function(t){var e=t.target.value;e=e>0?e:0,this.setState({damping:e}),this.engine&&this.engine.set_damping(e)}},{key:"onToggleElastic",value:function(){var t=!this.state.elastic;this.setState({elastic:t}),this.engine&&this.engine.set_elastic_enabled(t)}},{key:"onToggleGravity",value:function(){var t=!this.state.gravity;this.setState({gravity:t}),this.engine&&this.engine.set_gravity_enabled(t)}},{key:"onToggleCollision",value:function(){var t=!this.state.collision;this.setState({collision:t}),this.engine&&this.engine.set_collision_enabled(t)}},{key:"d3Loop",value:function(){var t=this,e=0,n=performance.now(),a=new Array(this.state.amount);this.animation=window.requestAnimationFrame((function i(){t.engine.tick(a);var s=!0,r=!1,o=void 0;try{for(var h,l=a[Symbol.iterator]();!(s=(h=l.next()).done);s=!0){var c=h.value;A[c.id].attr("x",c.x).attr("y",c.y)}}catch(u){r=!0,o=u}finally{try{s||null==l.return||l.return()}finally{if(r)throw o}}e+=1,performance.now()-n>1e3&&(t.setState({fps:e}),e=0,n=performance.now()),t.animation=window.requestAnimationFrame(i)}))}},{key:"tjLoop",value:function(){var t=this,e=0,n=performance.now(),a=new Array(this.state.amount);this.animation=window.requestAnimationFrame((function i(){t.animation=window.requestAnimationFrame(i),t.engine.tick(a);var s=!0,r=!1,o=void 0;try{for(var h,l=a[Symbol.iterator]();!(s=(h=l.next()).done);s=!0)h.value}catch(c){r=!0,o=c}finally{try{s||null==l.return||l.return()}finally{if(r)throw o}}e+=1,performance.now()-n>1e3&&(t.setState({fps:e}),e=0,n=performance.now()),t.tj.renderer.render(t.tj.scene,t.tj.camera)}))}},{key:"renderControls",value:function(){var t=this;return i.a.createElement("div",{className:"controls"},i.a.createElement("button",{onClick:this.start},"Start"),i.a.createElement("button",{onClick:this.stop},"Stop"),i.a.createElement("button",{onClick:this.restart},"Restart"),i.a.createElement("button",{onClick:this.center},"Center"),i.a.createElement("div",{className:"check"},i.a.createElement("p",null,"Amount"),i.a.createElement("input",{type:"number",style:{width:100},value:this.state.amount,onChange:this.onChangeAmount.bind(this)})),i.a.createElement("div",{className:"check"},i.a.createElement("p",null,"Sun Mass"),i.a.createElement("input",{type:"number",style:{width:100},step:"50",value:this.state.sunMass,onChange:this.onChangeSunMass.bind(this)})),i.a.createElement("div",{className:"check"},i.a.createElement("p",null,"G Constant"),i.a.createElement("input",{type:"number",step:"0.0001",style:{width:100},value:this.state.gravityConstant,onChange:this.onChangeGravityConstant.bind(this)})),i.a.createElement("div",{className:"check"},i.a.createElement("p",null,"Damping"),i.a.createElement("input",{type:"number",step:"0.001",style:{width:100},value:this.state.damping,onChange:this.onChangeDamping.bind(this)})),i.a.createElement("div",{className:"check"},this.state.d3?"D3":"TJ",i.a.createElement("input",{type:"checkbox",checked:this.state.d3,onChange:function(){return t.setState({d3:!t.state.d3})}})),i.a.createElement("div",{className:"check"},"WASM",i.a.createElement("input",{type:"checkbox",checked:this.state.wasm,onChange:function(){return t.setState({wasm:!t.state.wasm})}})),i.a.createElement("div",{className:"check"},"Elastic",i.a.createElement("input",{type:"checkbox",checked:this.state.elastic,onChange:this.onToggleElastic.bind(this)})),i.a.createElement("div",{className:"check"},"Gravity",i.a.createElement("input",{type:"checkbox",checked:this.state.gravity,onChange:this.onToggleGravity.bind(this)})),i.a.createElement("div",{className:"check"},"Collision",i.a.createElement("input",{type:"checkbox",checked:this.state.collision,onChange:this.onToggleCollision.bind(this)})))}},{key:"render",value:function(){return i.a.createElement("div",{className:"container"},this.renderControls(),i.a.createElement("div",{className:"content"},i.a.createElement("div",{id:"graph"}),i.a.createElement("span",null,this.state.fps," fps | ",this.state.wasm?"wasm":"js")))}}]),e}(a.Component);n(23);r.a.render(i.a.createElement(D,null),document.getElementById("root"))}},[[17,1,2]]]);
//# sourceMappingURL=main.ee064321.chunk.js.map